This is originally window_controller.cpp
